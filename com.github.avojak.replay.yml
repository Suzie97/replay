app-id: com.github.avojak.replay

runtime: io.elementary.Platform
runtime-version: '6.1'
sdk: io.elementary.Sdk

command: com.github.avojak.replay

finish-args:
  - '--device=dri' # For RetroGTK
  - '--share=ipc'
  - '--share=network'
  - '--socket=fallback-x11'
  - '--socket=wayland'
  - '--socket=pulseaudio' # For RetroGTK
  - '--filesystem=host' # For loading libretro cores
  - '--filesystem=home' # For loading ROMs and save data

modules:
  - name: retro-gtk
    buildsystem: meson
    sources:
      - type: git
        url: https://gitlab.gnome.org/GNOME/retro-gtk.git
        tag: '1.0.2'
  # TODO: Might make sense to maintain a fork of the cores and ROMs to ensure availability
  # LibRetro Cores
  - name: libretro-mgba
    # buildsystem: simple
    no-autogen: true
    sources:
      - type: git
        url: https://github.com/libretro/mgba.git
        branch: 'master' # TODO: Lock this down to a specific version/commit
      - type: file
        url: https://raw.githubusercontent.com/libretro/libretro-super/master/dist/info/mgba_libretro.info
        sha256: 60a285a1c8b2c0a032bc9ce34a725741ba020b74daeb7a9aa4598d5a5f94f5a5
    # build-commands:
    #   - make -f Makefile.libretro
    #   - install -d /app/share/com.github.avojak.replay/libretro/cores
    #   - install -m 644 mgba_libretro.so /app/share/com.github.avojak.replay/libretro/cores/mgba_libretro.so
    make-install-args:
      - prefix=/app # Installs to /app/lib/libretro/mgba_libretro.so
      # TODO: Figure out how to cleanup unnecessary files after the build
    post-install:
      - install -m 644 mgba_libretro.info /app/lib/libretro/mgba_libretro.info
  # - name: libretro-super
  #   buildsystem: simple
  #   # no-autogen: true
  #   sources:
  #     - type: git
  #       url: https://github.com/libretro/libretro-super.git
  #       branch: 'master'
  #   # make-install-args:
  #   #   - /app/share/libretro
  #   build-commands:
  #     - install -d /app/lib/libretro
  #     - install -m 644 dist/info/mgba_libretro.info /app/lib/libretro/mgba_libretro.info
  # ROMs
  - name: ROMs
    buildsystem: simple
    no-autogen: true
    sources:
      - type: dir
        path: data/roms
    build-commands:
      - install -d /app/lib/roms
      - install -m 644 -t /app/lib/roms ./*
    #   - install -m 644 GBWORDYL.gb /app/share/com.github.avojak.replay/roms/GBWORDYL.gb
  - name: replay
    buildsystem: meson
    sources:
      - type: dir
        path: .