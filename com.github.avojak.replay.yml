app-id: com.github.avojak.replay

runtime: io.elementary.Platform
runtime-version: '6.1'
sdk: io.elementary.Sdk

command: com.github.avojak.replay

finish-args:
  - '--device=dri' # For RetroGTK
  - '--share=ipc'
  - '--share=network'
  - '--socket=fallback-x11'
  - '--socket=wayland'
  - '--socket=pulseaudio' # For RetroGTK
  # - '--filesystem=host' # For loading libretro cores
  - '--filesystem=home' # For loading ROMs

modules:
  - name: retro-gtk
    buildsystem: meson
    sources:
      - type: git
        url: https://gitlab.gnome.org/GNOME/retro-gtk.git
        tag: '1.0.2'
  - name: libretro-mgba
    buildsystem: simple
    sources:
      - type: git
        url: https://github.com/libretro/mgba.git
        branch: 'master' # TODO: Lock this down to a specific version/commit
    build-commands:
      - make -f Makefile.libretro
      - install -d /app/share/com.github.avojak.replay/libretro/cores
      - install -m 644 mgba_libretro.so /app/share/com.github.avojak.replay/libretro/cores/mgba_libretro.so
  - name: libretro-super
    buildsystem: simple
    sources:
      - type: git
        url: https://github.com/libretro/libretro-super.git
        branch: 'master'
    build-commands:
      - install -d /app/share/com.github.avojak.replay/libretro/cores
      - install -m 644 dist/info/mgba_libretro.info /app/share/com.github.avojak.replay/libretro/cores/mgba_libretro.info
  - name: replay
    buildsystem: meson
    sources:
      - type: dir
        path: .