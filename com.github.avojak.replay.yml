app-id: com.github.avojak.replay

runtime: io.elementary.Platform
runtime-version: '6.1'
sdk: io.elementary.Sdk

command: com.github.avojak.replay

finish-args:
  - '--device=dri' # For RetroGTK
  - '--share=ipc'
  - '--share=network'
  - '--socket=fallback-x11'
  - '--socket=wayland'
  - '--socket=pulseaudio' # For RetroGTK
  - '--filesystem=host' # For loading libretro cores
  - '--filesystem=home'

modules:
  - name: retro-gtk
    buildsystem: meson
    sources:
      - type: git
        url: https://gitlab.gnome.org/GNOME/retro-gtk.git
        tag: '1.0.2'
  - name: libretro-gearboy
    buildsystem: simple
    sources:
      - type: git
        url: https://github.com/drhelius/gearboy.git
        tag: 'gearboy-3.4.0'
    build-commands:
      - make -C platforms/libretro
      - install -d /app/share/libretro/cores
      - install -m 644 platforms/libretro/gearboy_libretro.so /app/share/libretro/cores/gearboy_libretro.so
      - install -m 644 platforms/libretro/gearboy_libretro.info /app/share/libretro/cores/gearboy_libretro.info
  - name: libretro-meteor
    buildsystem: simple
    sources:
      - type: git
        url: https://github.com/libretro/meteor-libretro.git
        branch: 'master'
    build-commands:
      - make -C libretro
      - install -d /app/share/libretro/cores
      - install -m 644 libretro/meteor_libretro.so /app/share/libretro/cores/meteor_libretro.so
      # TODO: Maybe get these files from here? https://github.com/libretro/libretro-super/blob/master/dist/info/meteor_libretro.info
      # - install -m 644 libretro/meteor_libretro.info /app/share/libretro/cores/meteor_libretro.info
  - name: replay
    buildsystem: meson
    sources:
      - type: dir
        path: .