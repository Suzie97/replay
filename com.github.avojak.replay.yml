app-id: com.github.avojak.replay

runtime: io.elementary.Platform
runtime-version: '6.1'
sdk: io.elementary.Sdk

command: com.github.avojak.replay

finish-args:
  - '--device=dri' # For RetroGTK
  - '--share=ipc'
  - '--share=network'
  - '--socket=fallback-x11'
  - '--socket=wayland'
  - '--socket=pulseaudio' # For RetroGTK
  - '--filesystem=host' # For loading libretro cores
  - '--filesystem=home' # For loading ROMs and save data

modules:
  - name: retro-gtk
    buildsystem: meson
    sources:
      - type: git
        url: https://gitlab.gnome.org/GNOME/retro-gtk.git
        tag: '1.0.2'
  # TODO: Might make sense to maintain a fork of the cores and ROMs to ensure availability
  # LibRetro Cores
  - name: libretro-mgba
    no-autogen: true
    sources:
      - type: git
        url: https://github.com/libretro/mgba.git
        branch: 'master' # TODO: Lock this down to a specific version/commit
    make-install-args:
      - prefix=/app # Installs to /app/lib/libretro/mgba_libretro.so
      # TODO: Figure out how to cleanup unnecessary files after the build
  # - name: libretro-quicknes
  #   no-autogen: true
  #   sources:
  #     - type: git
  #       url: https://github.com/libretro/QuickNES_Core
  #       branch: 'master'
  #   no-make-install: true
  #   post-install:
  #     - install -m 644 quicknes_libretro.so /app/lib/libretro/quicknes_libretro.so
  # - name: libretro-bnes
  #   no-autogen: true
  #   sources:
  #     - type: git
  #       url: https://github.com/libretro/bnes-libretro.git
  #       branch: 'master'
  #   no-make-install: true
  #   post-install:
  #     - install -m 644 bnes_libretro.so /app/lib/libretro/bnes_libretro.so
  # - name: libretro-bsnes-mercury-performance
  #   no-autogen: true
  #   sources:
  #     - type: git
  #       url: https://github.com/libretro/bsnes-mercury.git
  #       branch: 'master'
  #   no-make-install: true
  #   post-install:
  #     - install -m 644 bsnes_mercury_performance_libretro.so /app/lib/libretro/bsnes_mercury_performance_libretro.so
  # Install the LibRetro info files for only the bundled cores
  - name: libretro-core-info
    buildsystem: simple
    no-autogen: true
    sources:
      - type: git
        url: https://github.com/libretro/libretro-core-info.git
        tag: 'v1.10.1'
    build-commands:
      - install -m 644 mgba_libretro.info /app/lib/libretro/mgba_libretro.info
      # - install -m 644 quicknes_libretro.info /app/lib/libretro/quicknes_libretro.info
      # - install -m 644 bnes_libretro.info /app/lib/libretro/bnes_libretro.info
  # ROMs
  - name: ROMs
    buildsystem: simple
    no-autogen: true
    sources:
      - type: dir
        path: data/roms
    build-commands:
      - install -d /app/lib/roms
      - install -m 644 -t /app/lib/roms ./*
  - name: replay
    buildsystem: meson
    sources:
      - type: dir
        path: .